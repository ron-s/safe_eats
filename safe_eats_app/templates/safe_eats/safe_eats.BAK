<html>
<head>
    <title>Safe Eats</title>

    <meta charset="UTF-8">
    <title>Safe Eats</title>
    <link rel="stylesheet" href="../static/safe_eats/css/styles.css">
    <style type="text/css"></style>
</head>

<body>

<div id="map"></div>
<script src="http://maps.google.com/maps/api/js?sensor=false"
        type="text/javascript"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
<script>

    var loc = {{ restaurants|safe }};

    var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 11,
        center: new google.maps.LatLng(47.608013, -122.335167)
    });
    var markers = []
    var infowindows = []



    for (var x in loc){
        var obj = loc[x];

        var contentString = '<div><b>'+ obj.name +'</b></div>'+'<div>'+ obj.address +'</div>'+'<div>'+ 'Inspection Result:  ' + obj.results.result_1.inspection_result +'</div>'+'<div>'+ obj.results.result_1.description +'</div>';


        var infowindow = new google.maps.InfoWindow({
            content: contentString
        });

        var marker = new google.maps.Marker({
            position: new google.maps.LatLng(obj.latitude, obj.longitude),
            map: map,
            title: obj.address
        });

        listenMarker(marker)

    }

function listenMarker (marker){
    // so marker is associated with the closure created for the listenMarker function call
    google.maps.event.addListener(marker, 'click', function() {
        infowindow.open(map, marker);
        });
    }

        // marker.addListener('click', function(){
        //     infowindow.open(map, marker)
        // })

        // console.log("content string b4 fancy stuff, ", contentString);
        // google.maps.event.addListener(marker, 'click', (function (marker) {
        //     return function () {
                
        //         infowindow.open(map, marker);
        //         console.log('contentString is: ', contentString);
        //     }
        // })(marker));


</script>
</body>
</html>