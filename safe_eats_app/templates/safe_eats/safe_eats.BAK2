<html>
<head>
    <title>Safe Eats</title>

    <meta charset="UTF-8">
    <title>Safe Eats</title>
    <link rel="stylesheet" href="../static/safe_eats/css/styles.css">
    <style type="text/css"></style>
</head>

<body onload="initialize()">

<div id="map"></div>
<script src="http://maps.google.com/maps/api/js?sensor=false"
        type="text/javascript"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
<script>
    var infos = [];
    var loc = {{ restaurants|safe }};

    function initialize() {

        var myOptions = {
            center: new google.maps.LatLng(47.608013, -122.335167),
            zoom: 10,
            mapTypeId: google.maps.MapTypeId.ROADMAP

        };
        var map = new google.maps.Map(document.getElementById("map"),
                myOptions);

        setMarkers(map, loc)

    }


    function setMarkers(map, loc) {

        for (var i in loc) {
            var obj = loc[i];
            var name = obj.name;
            var lat = obj.latitude;
            var long = obj.longitude;

            latlngset = new google.maps.LatLng(lat, long);

            var marker = new google.maps.Marker({
                map: map, title: name, position: latlngset
            });
            map.setCenter(marker.getPosition());

            var content = '<div><b>' + obj.name + '</b></div>' + '<div>' + obj.address + '</div>' + '<div>' + 'Inspection Result:  ' + obj.results.result_1.inspection_result + '</div>' + '<div>' + obj.results.result_1.description + '</div>';

            var infowindow = new google.maps.InfoWindow();

            google.maps.event.addListener(marker, 'click', (function (marker, content, infowindow) {
                return function () {
                    /* close the previous info-window */
                    closeInfos();
                    infowindow.setContent(content);
                    infowindow.open(map, marker);
                    /* keep the handle, in order to close it on next click event */
                    infos[0] = infowindow;
                };
            })(marker, content, infowindow));
        }
    }

    function closeInfos() {
        if (infos.length > 0) {
            /* detach the info-window from the marker ... undocumented in the API docs */
            infos[0].set("marker", null);
            /* and close it */
            infos[0].close();
            /* blank the array */
            infos.length = 0;
        }
    }
</script>
</body>
